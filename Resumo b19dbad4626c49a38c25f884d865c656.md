# Resumo

## Optig Trading Chain includes:

| Optiq  | The relational app on UTP(legacy) | App Detail |
| --- | --- | --- |
| Order Entry Gateway (OEG) (3BE ‚Ä¢ FIX) | Customer Client Gateway (CCG) | Sua funcionalidade consiste em permitir que os brokers, os membors da Exchange, consigam ligar √† Exchange, ou seja, as firmas que estao autorizadas e craidas na matrix e que assim possuem a possibilidade de criar ordens, cancelar ordens, fazer tradings‚Ä¶

como uma firma fica autorizada a ter acesso ao OEG ?  
A firma deve existir na matrix e deve ter componente criada na OEG admin

Para cada logical access id(id atribuido para uma firma) apenas √© poss√≠vel associar um protocolo de comunicacaao, ou SBE (BIN) ou FIX. para fazer resquests. De todas as aplicacoes do optiq apenas OEG possui o protocolo SBI, SBE e FIX, o restante das aplicacoes apenas possui SBE.

O OEG tambem efetua validacoes da cabeca dos requests, se esta formatado corretamente, caso nao estaja, √© enviado uma mensagem imediatamente ao broker alertando que o request foi regeitado e as razoes por ter acontecido isso. quando recebe um request FIX ele converte internamente para SBE, pois o mensagens de protocolo SBE sao mais r√°pidas.

No caso do request chegar tudo ok no OEG,  far√° um do resquest forward para o ME(Matchin Engine) |
| Matching Engine (ME)  | Matching Engine (ME)  | matching Engine √© onde possui toda a logica de negocio, o que quer dizer que vai validar a mensagem que est√° a receber do OEG, mas numa pespectiva funcional.

O ME armazena o m√≠nimo de infroma√ß√µe s das ordens em mem√≥ria, para permitir a optiq ser mais r√°pida |
| Market Data Gateway (MDG) (SBE) |  XDP - Exchange Data Publisher | Responsavel por mandar para o mercado, por informar o mercado, a cerca de todas as interacoes que estao a acontecer entre o mundo exterior e a bolsa.  Imagine o seguinte senario, um user enviando ordens √† OEG que quer comprar/vender e uma s√©rie de outros users a fazer o mesmo, isso impacta o mercado, ou seja,  a quantidade que esta disponivel para ser comprarda/vendida varia mediante essas interacoes, assim o MDG manda para o mercado as ‚Äúconsequencias‚Äù das interacoes entre os brokers e exchange, consistindo essas ‚Äúconsequencias‚Äù sendo alteracoes nos volumes/quantidades que estao disponiveis de acoes, compreendendo um public flow. |
| Persistence Engine (PE)  | Shared Memory | Persistence Engine √© uma base de dados que vai guardando toda a informacao do que vai acontecendo durante o dia.
‚Üí Schema que contem tabelas:
           -  informacao de transacoes que sao efetuadas durante um trade day (Ordens, Trades‚Ä¶)
           - referencial data que sao usados o trade day(firmas, intrumentos, trading groups, trading patterns‚Ä¶)
 |
| Iaca Inside (SBE Internal) | N/A | Respons√°vel por gerar a IA Short messages( fragmentacao das infrmacoes de uma ordem ) qie depois ser√° gerado IA Long message( mensagem com toda a infromacao sobre cada ordem) e que ser√° feito um update no PE assim como permite o Drop Copy notificar que a nova ordem foi criada( https://www.notion.so/OPTIQ-4f5a719c84ba41efaf46b76934979367 )

 IACA Inside gera uma mensagem interna(IA Order New Modify) que √© usada para comunicar aos diferentes componentes do optiq que a ordem exite e envia para os outros icas que existem.

OBS:. as IA short ficam ‚Äúpasseando‚Äù dentro dos iacas e existe a iaca finish que √© reponsavel por pegar a infromacao da iaca short em que vai guardando essa informacao em memoria e com essas inforomacoes que vai pegando do iaca short, vai gerar quilo que √© chamado de iaca long order, onde ele armazena em momeria alem das infromacoes da ordem, infromacoes que estao do lado da iaca finish 

EXEMPLO DO FLOW:
- criada uma nova ordem
- a ordem √© validada pelo OEG, estando tudo ok passa para o ME
- no ME √© feita valida√ß√µes nesta mensagem, estando tudo ok gera um evento ‚ÄúAckData‚Äù que promove a cria√ß√£o do Ack (03) do qual √© enviado para o Broker que submeteu a mensagem 
- o ME tamb√©m cria um evento que envia para o MDG para que o MDG efetue um update da mensagem da ordem que precisa ser ‚Äúbroadcast‚Äù para o mundo externo
- IACA inside gera uma mensafem interna (IA Order New Modify) que √© usada para comunicar aos diferentes componentes do optiq que a ordem existe.  |
| INCA Finish | N/A | Pega a IA Short Messages e os fragmentos e controi as IA Long Messages, do qual ser√° publicada dentro do Kafka e repassada para outras aplicacoes, como por exemplo as IACA Copy

EXEMPLO: 
 |
| IACA Copy | N/A | IACA Copy pega nas mesngens IA Long que sao emitidas no IACA Finish e connstroi uma mensagem exatamente igual √† IA Long s√≥ que com outro nome. Basicamente funciona como um filtro de infromacoes de ordens criadas para Firmas que possui acesso ao Drop Copy, ou seja, no IACA Finish possui todas as IA long de todas as Firmas geradas durante o trading, no IACA Copy √© possivel obter todas as infroma√ß√µes de uma respetiva Firma.
A importancia de uma Firma possuir o Drop Copy est√° ligada √† esta ferrament dser muilt seguiment e poder fornarcer informacoes dos diferentes Logical Access (LA) que √© necessario um para cada seguimento que a forma queira negociar, seja ele o seguimento de Derivados, cash, WAR‚Ä¶. ou entao que possa efetuar o https://www.notion.so/OPTIQ-4f5a719c84ba41efaf46b76934979367
IACA Copy tem acessos para o view populado pelo PE para que saiba quais mensagens ele deve considerar e quais deve ignorar. 
Obs: Drop Copy √© muit seguimentos. |
| IACA Store |  | Apenas v√™ as mensagens no KAFKA e as salva em uma base de dados.
Caso ele veja uma IA New Order Modify, pega nela e insere uma nova linha na tebela das ordens.
Pose atualizar dados em ordens j√° existentes.
IACA Store √© utilizado no MENA, j√° no optiq Euronext, a mesma ferramente possui o nome de IAKAFKA2DB 
 |

<aside>
üí° Todos os IACA‚Äôs correm na m√°quina do PE

</aside>

<aside>
üí° O Main-CT se comunica com os IACA‚Äôs atraves do KAFKA

</aside>

<aside>
üí° EXEMPLO 2:

seja o caso em que uma firma(broker) tenha um ID 00001 e logical Access(LA) 342 em que esta firma possui acessos √† Exchange, como temos outros dois brokers que nao possuem acessos √† Exchang mas desejam criar ordens, assim o que a Frima com acesso pode fazer o seguinte

Firma 00001, LA 342
Firma 00001, LA 999 ‚Üí firma sem acesso
Firma 00001, LA 888 ‚Üí frima sem acesso 

Friam 00001, Drop Copy LA 767 ‚Üí vai receber todo o flow submetido pela Firma 00001 em todos os LA‚Äôs (342, 999, 888)

Assim as Frimas sem acessos podem criar as ordens e toda a notificacoes das mensagens geradas por essas firmas ser√° notificado √† Firma com acessos. Em que sao criados LA‚Äôs para cada uma das outras Firmas.

</aside>